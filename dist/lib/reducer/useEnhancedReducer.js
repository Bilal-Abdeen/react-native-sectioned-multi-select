var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=useEnhancedReducer;exports.loggerMiddleware=loggerMiddleware;exports.thunkMiddleware=thunkMiddleware;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var React=_interopRequireWildcard(require("react"));function compose(fns){return function(initial){return fns.reduceRight(function(prev,fn){return fn(prev);},initial);};}function useEnhancedReducer(reducer,initalState){var middlewares=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var stateRef=React.useRef(initalState);var _React$useReducer=React.useReducer(reducer,initalState),_React$useReducer2=(0,_slicedToArray2.default)(_React$useReducer,2),state=_React$useReducer2[0],realDispatch=_React$useReducer2[1];React.useEffect(function(){stateRef.current=state;},[state]);if(!Array.isArray(middlewares)||middlewares.length===0){return[state,realDispatch];}var dispatchWithPromise=usePromisifiedDispatch(realDispatch,state);var outerDispatch=React.useMemo(function(){var _dispatch=function dispatch(){throw new Error("Dispatching while constructing your middleware is not allowed. "+"Other middleware would not be applied to this dispatch.");};var middlewareAPI={getState:function getState(){return stateRef.current;},dispatch:function dispatch(action){return _dispatch(action);},reducer:reducer};var chain=middlewares.map(function(middleware){return middleware(middlewareAPI);});_dispatch=compose(chain)(dispatchWithPromise);return _dispatch;},[dispatchWithPromise].concat((0,_toConsumableArray2.default)(middlewares)));console.log('reducer1',state,outerDispatch);return[state,outerDispatch];}function usePromisifiedDispatch(dispatch,state){var dispatchPromiseRef=React.useRef(null);React.useEffect(function(){if(dispatchPromiseRef.current){dispatchPromiseRef.current.resolve(state);dispatchPromiseRef.current=null;}},[state]);return React.useCallback(function(action){if(!dispatchPromiseRef.current){dispatchPromiseRef.current=NewPromiseHolder();}var promise=dispatchPromiseRef.current.promise;dispatch(action);return promise;},[dispatch]);}function NewPromiseHolder(){var promiseHolder={};promiseHolder.promise=new Promise(function(resolve){promiseHolder.resolve=resolve;});return promiseHolder;}function loggerMiddleware(_ref){var getState=_ref.getState,dispatch=_ref.dispatch;return function(next){return function _callee(action){return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.group(typeof action==='function'?'thunk':action.type);console.info('%cPrevious State:','color: salmon; font-weight: 700;',getState());_context.next=4;return _regenerator.default.awrap(next(action));case 4:console.log('%cNext State:','color: teal; font-weight: 700;',getState());console.groupEnd();case 6:case"end":return _context.stop();}}},null,null,null,Promise);};};}function thunkMiddleware(_ref2){var getState=_ref2.getState,dispatch=_ref2.dispatch;return function(next){return function _callee2(action){return _regenerator.default.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(typeof action==='function')){_context2.next=4;break;}console.log('thunking - action is function');action(getState,dispatch);return _context2.abrupt("return");case 4:console.log('dispatching - action not function');return _context2.abrupt("return",next(action));case 6:case"end":return _context2.stop();}}},null,null,null,Promise);};};}